<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Financial Report - Tạo Báo Cáo Tài Chính Chuyên Nghiệp</title>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#f59e0b',
                        accent: '#10b981',
                        dark: '#0f172a',
                        light: '#f8fafc',
                        financial: '#1e3a8a',
                        gold: '#fbbf24'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-out',
                        'slide-up': 'slideUp 0.8s ease-out',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(40px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3b82f6 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .input-focus {
            transition: all 0.3s ease;
        }
        
        .input-focus:focus {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.3);
        }
        
        .btn-hover {
            transition: all 0.3s ease;
        }
        
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.4);
        }
        
        .feature-card {
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-animation {
            animation: successPulse 0.6s ease-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .textarea-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .textarea-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .textarea-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        .textarea-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass-effect">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center">
                        <i class="fas fa-chart-line text-primary text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-white font-bold text-xl">AI Financial Report</h1>
                        <p class="text-white/70 text-sm">Báo Cáo Tài Chính Thông Minh</p>
                    </div>
                </div>
                
                <nav class="hidden md:flex space-x-8">
                    <a href="#features" class="text-white/80 hover:text-white transition-colors">Tính năng</a>
                    <a href="#how-it-works" class="text-white/80 hover:text-white transition-colors">Cách hoạt động</a>
                    <a href="#examples" class="text-white/80 hover:text-white transition-colors">Ví dụ</a>
                </nav>
                
                <button class="bg-white text-primary px-6 py-2 rounded-lg font-semibold btn-hover">
                    <i class="fas fa-play mr-2"></i>
                    Xem Demo
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="pt-32 pb-20 px-6">
        <div class="container mx-auto text-center">
            <div class="animate-fade-in">
                <h1 class="text-5xl md:text-7xl font-bold text-white mb-6">
                    Tạo Báo Cáo Tài Chính
                    <span class="block text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-600">
                        Chuyên Nghiệp
                    </span>
                </h1>
                
                <p class="text-xl text-white/80 mb-12 max-w-3xl mx-auto leading-relaxed">
                    Nhập thông tin tài chính và để AI tạo ra báo cáo chuyên nghiệp với biểu đồ tương tác, 
                    phân tích dữ liệu và visualization tài chính chỉ trong vài giây.
                </p>
            </div>
            
            <!-- Input Form -->
            <div class="max-w-4xl mx-auto animate-slide-up">
                <div class="glass-effect rounded-2xl p-8 mb-8">
                    <div class="text-left mb-6">
                        <label class="text-white font-semibold text-lg mb-3 block">
                            <i class="fas fa-chart-line mr-2 text-yellow-400"></i>
                            Nhập thông tin tài chính cho báo cáo
                        </label>
                        <textarea 
                            id="userPrompt" 
                            class="w-full h-32 bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-white/50 resize-none focus:outline-none focus:ring-2 focus:ring-primary input-focus textarea-scrollbar"
                            placeholder="Ví dụ: Báo cáo tài chính quý 4/2024 của công ty FPT với doanh thu 15.000 tỷ đồng, lợi nhuận sau thuế 2.500 tỷ, tăng trưởng 15% so với cùng kỳ..."
                        ></textarea>
                        
                        <div class="flex items-center justify-between mt-3">
                            <div class="text-white/60 text-sm">
                                <i class="fas fa-info-circle mr-1"></i>
                                Càng chi tiết, kết quả càng chất lượng
                            </div>
                            <div class="text-white/60 text-sm">
                                <span id="charCount">0</span> ký tự
                            </div>
                        </div>
                    </div>
                    
                    <button 
                        id="generateBtn"
                        class="w-full bg-gradient-to-r from-financial to-gold text-white font-bold py-4 px-8 rounded-xl text-lg btn-hover disabled:opacity-50 disabled:cursor-not-allowed"
                        onclick="generatePresentation()"
                    >
                        <span id="btnText">
                            <i class="fas fa-chart-bar mr-2"></i>
                            Tạo Báo Cáo Tài Chính
                        </span>
                        <span id="btnLoading" class="hidden">
                            <div class="loading-spinner inline-block mr-2"></div>
                            Đang tạo báo cáo...
                        </span>
                    </button>
                </div>
                
                <!-- Quick Examples -->
                <div class="text-center">
                    <p class="text-white/70 mb-4">Hoặc thử các ví dụ nhanh:</p>
                    <div class="flex flex-wrap justify-center gap-3">
                        <button onclick="setQuickExample('Báo cáo tài chính FPT năm 2024 với doanh thu và lợi nhuận chi tiết')" class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-building mr-1"></i>
                            Báo cáo FPT 2024
                        </button>
                        <button onclick="setQuickExample('Thông tin tài sản và đầu tư của ông Phạm Nhật Vượng - Vingroup')" class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-user-tie mr-1"></i>
                            Phạm Nhật Vượng
                        </button>
                        <button onclick="setQuickExample('Phân tích tài chính ngân hàng Vietcombank quý 4/2024')" class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                            <i class="fas fa-university mr-1"></i>
                            Vietcombank Q4/2024
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-20 px-6">
        <div class="container mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold text-white mb-4">Tính năng Tài Chính</h2>
                <p class="text-white/70 text-lg max-w-2xl mx-auto">
                    Tất cả những gì bạn cần để tạo báo cáo tài chính chuyên nghiệp
                </p>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="feature-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-financial to-gold rounded-xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-calculator text-white text-2xl"></i>
                    </div>
                    <h3 class="text-white font-semibold text-lg mb-2">Phân Tích Tài Chính</h3>
                    <p class="text-white/70 text-sm">AI phân tích dữ liệu tài chính và tạo báo cáo chuyên sâu</p>
                </div>
                
                <div class="feature-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-accent to-financial rounded-xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-chart-line text-white text-2xl"></i>
                    </div>
                    <h3 class="text-white font-semibold text-lg mb-2">Biểu Đồ Tài Chính</h3>
                    <p class="text-white/70 text-sm">Tự động tạo biểu đồ doanh thu, lợi nhuận, dòng tiền</p>
                </div>
                
                <div class="feature-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-gold to-secondary rounded-xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-coins text-white text-2xl"></i>
                    </div>
                    <h3 class="text-white font-semibold text-lg mb-2">Dự Báo Tài Chính</h3>
                    <p class="text-white/70 text-sm">Dự đoán xu hướng tài chính dựa trên dữ liệu lịch sử</p>
                </div>
                
                <div class="feature-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-primary to-gold rounded-xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-file-invoice-dollar text-white text-2xl"></i>
                    </div>
                    <h3 class="text-white font-semibold text-lg mb-2">Báo Cáo Thuế</h3>
                    <p class="text-white/70 text-sm">Tự động tính toán và báo cáo thuế chính xác</p>
                </div>
                
                <div class="feature-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-secondary to-accent rounded-xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-university text-white text-2xl"></i>
                    </div>
                    <h3 class="text-white font-semibold text-lg mb-2">So Sánh Ngân Hàng</h3>
                    <p class="text-white/70 text-sm">So sánh lãi suất và dịch vụ các ngân hàng</p>
                </div>
                
                <div class="feature-card glass-effect rounded-xl p-6 text-center">
                    <div class="w-16 h-16 bg-gradient-to-r from-gold to-primary rounded-xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-piggy-bank text-white text-2xl"></i>
                    </div>
                    <h3 class="text-white font-semibold text-lg mb-2">Quản Lý Chi Tiêu</h3>
                    <p class="text-white/70 text-sm">Phân tích chi tiêu và gợi ý tiết kiệm</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-12 px-6 border-t border-white/10">
        <div class="container mx-auto text-center">
            <div class="flex items-center justify-center space-x-3 mb-4">
                <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center">
                    <i class="fas fa-presentation text-primary text-sm"></i>
                </div>
                <span class="text-white font-semibold">AI Financial Report</span>
            </div>
            <p class="text-white/60 text-sm">
                © 2024 AI Financial Report. Tạo báo cáo tài chính chuyên nghiệp với AI.
            </p>
        </div>
    </footer>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 success-animation">
            <div class="text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check text-green-500 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-800 mb-2">Thành công!</h3>
                <p class="text-gray-600 mb-6">Báo cáo tài chính của bạn đã được tạo xong.</p>
                <div class="flex space-x-3">
                    <button 
                        onclick="viewPresentation()" 
                        class="flex-1 bg-primary text-white px-6 py-3 rounded-lg font-semibold hover:bg-primary/90 transition-colors"
                    >
                        <i class="fas fa-eye mr-2"></i>
                        Xem Báo Cáo
                    </button>
                    <button 
                        onclick="closeModal()" 
                        class="flex-1 bg-gray-200 text-gray-800 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors"
                    >
                        Đóng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://localhost:5678/webhook/ai-slide-autogen';
        
        // DOM Elements
        const userPrompt = document.getElementById('userPrompt');
        const generateBtn = document.getElementById('generateBtn');
        const btnText = document.getElementById('btnText');
        const btnLoading = document.getElementById('btnLoading');
        const charCount = document.getElementById('charCount');
        const successModal = document.getElementById('successModal');
        
        // Character counter
        userPrompt.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            // Removed character limit styling
        });
        
        // Generate presentation function
        async function generatePresentation() {
            const prompt = userPrompt.value.trim();
            
            if (!prompt) {
                showNotification('Vui lòng nhập mô tả presentation!', 'error');
                return;
            }
            
            // Removed character limit validation
            
            // Show loading state
            setLoadingState(true);
            
            try {
                // Call API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_prompt: prompt
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // Save to slide.json
                await saveSlideData(result);
                
                // Show success modal
                showSuccessModal();
                
            } catch (error) {
                console.error('Error generating presentation:', error);
                showNotification('Có lỗi xảy ra khi tạo báo cáo tài chính. Vui lòng thử lại!', 'error');
            } finally {
                setLoadingState(false);
            }
        }
        
        // Save slide data to JSON file
        async function saveSlideData(data) {
            try {
                // Convert data to the format expected by preview-slide.html
                const slideData = {
                    slides: data.slides || data.slide_data || data,
                    metadata: {
                        title: data.title || 'AI Generated Presentation',
                        created_at: new Date().toISOString(),
                        prompt: userPrompt.value.trim()
                    }
                };
                
                console.log('Saving slide data:', slideData);
                
                // Save to server - gửi trực tiếp slideData thay vì wrap trong slide_data
                const response = await fetch('/save-slide-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(slideData)
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.warn('Failed to save to server:', response.status, errorText);
                    console.warn('Falling back to localStorage');
                    localStorage.setItem('slideData', JSON.stringify(slideData));
                    return false;
                }
                
                const result = await response.json();
                console.log('Slide data saved successfully:', result);
                
                // Also save to localStorage for immediate access
                localStorage.setItem('slideData', JSON.stringify(slideData));
                return true;
                
            } catch (error) {
                console.error('Error saving slide data:', error);
                // Fallback to localStorage
                const slideData = {
                    slides: data.slides || data.slide_data || data,
                    metadata: {
                        title: data.title || 'AI Generated Presentation',
                        created_at: new Date().toISOString(),
                        prompt: userPrompt.value.trim()
                    }
                };
                localStorage.setItem('slideData', JSON.stringify(slideData));
                return false;
            }
        }
        
        // Set loading state
        function setLoadingState(loading) {
            if (loading) {
                generateBtn.disabled = true;
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');
                userPrompt.disabled = true;
            } else {
                generateBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
                userPrompt.disabled = false;
            }
        }
        
        // Show success modal
        function showSuccessModal() {
            successModal.classList.remove('hidden');
            successModal.classList.add('flex');
        }
        
        // Close modal
        function closeModal() {
            successModal.classList.add('hidden');
            successModal.classList.remove('flex');
        }
        
        // View presentation
        function viewPresentation() {
            // Save the prompt and data for the preview page
            sessionStorage.setItem('presentationPrompt', userPrompt.value.trim());
            
            // Redirect to preview page
            window.location.href = './preview-slide.html';
        }
        
        // Quick examples
        function setQuickExample(text) {
            userPrompt.value = text;
            charCount.textContent = text.length;
            userPrompt.focus();
            
            // Scroll to input
            userPrompt.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-medium animate-slide-up ${
                type === 'error' ? 'bg-red-500' : 'bg-primary'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} mr-2"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Add scroll effect to header
        window.addEventListener('scroll', function() {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.style.background = 'rgba(255, 255, 255, 0.95)';
                header.style.backdropFilter = 'blur(10px)';
                header.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.1)';
            } else {
                header.style.background = 'rgba(255, 255, 255, 0.1)';
                header.style.backdropFilter = 'blur(10px)';
                header.style.boxShadow = 'none';
            }
        });
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on input
            userPrompt.focus();
            
            // Add some entrance animations
            const elements = document.querySelectorAll('.feature-card');
            elements.forEach((element, index) => {
                element.style.animationDelay = `${index * 0.1}s`;
            });
        });
    </script>
</body>
</html>